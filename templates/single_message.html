<!DOCTYPE html>
<html>
<head>
  <title>Single HL7 Message Parser</title>
  <link rel="icon" href="/static/favicon.ico">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fafafa;
      padding: 20px;
    }

    /* Nav bar */
    .nav-bar {
      margin-bottom: 12px;
    }

    .back-link {
      text-decoration: none;
      font-size: 14px;
      color: #b71c1c;
      font-weight: bold;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    /* Form */
    textarea {
      width: 100%;
      height: 220px;
      font-family: monospace;
      font-size: 13px;
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-actions {
      margin-top: 10px;
      margin-bottom: 20px;
    }

    /* Shared card styles (same as error-log parser) */
    .card {
      border: 1px solid #ccc;
      margin-bottom: 14px;
      background: #fff;
      border-radius: 4px;
    }

    .card-header {
      background: #e3f2fd;
      padding: 8px 10px;
      position: relative;
      font-size: 14px;
    }

    .card-body {
      padding: 10px;
    }

    .card.collapsed .card-body {
      display: none;
    }

    .toggle {
      float: right;
      cursor: pointer;
      border: none;
      background: transparent;
      font-size: 16px;
      line-height: 1;
      padding: 0 4px;
    }

    .toggle:hover {
      transform: scale(1.15);
    }

    .error {
      background: #fdecea;
      padding: 8px 10px;
      border-left: 4px solid #d32f2f;
      font-weight: bold;
    }

    .info {
      background: #f0f0f0;
      padding: 8px 10px;
      border-left: 4px solid #9e9e9e;
      font-style: italic;
    }

    .acc {
      background: #f7f7f7;
      padding: 8px 10px;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .order {
      margin-top: 12px;
      font-size: 14px;
    }

    .obr-line {
      margin-bottom: 6px;
      font-weight: bold;
    }

    .obx {
      margin-left: 20px;
      padding: 4px 0;
      font-size: 13px;
    }

    .obr-line button,
    .obx button {
      margin-right: 6px;
    }

    .highlight {
      background: #fff3cd;
      border-left: 4px solid #ff9800;
      padding-left: 6px;
    }
  </style>

  <script>
    function copyText(text) {
      navigator.clipboard.writeText(text);
      alert("Copied: " + text);
    }

    function toggleCard(btn) {
      const card = btn.closest('.card');
      if (!card) return;

      const isCollapsed = card.classList.toggle('collapsed');
      btn.textContent = isCollapsed ? '▸' : '▾';
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.card').forEach(card => {
        const btn = card.querySelector('.toggle');
        if (!btn) return;
        btn.textContent = card.classList.contains('collapsed') ? '▸' : '▾';
      });
    });
  </script>
</head>

<body>

  <div class="nav-bar">
    <a href="/" class="back-link">← Back to Menu</a>
  </div>

  <h2>Single HL7 Message Parser</h2>

  <form method="post">
    <textarea name="hl7" placeholder="Paste HL7 / ESI log content here...">{{ raw }}</textarea>

    <div class="form-actions">
      <button type="submit">Parse</button>
    </div>
  </form>

  <div id="output">
    {{ output|safe }}
  </div>
<footer style="margin-top:40px; font-size:12px; color:#777; text-align:center;">
  HL7 Tools v1.1 • Authored by HUBERMAR "THING2" • marc.huber@med.usc.edu • MIT License
</footer>

</body>
</html>
